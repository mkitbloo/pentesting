require 'net/http'
require 'uri'

def send_request(url, payload)
  uri = URI.parse(url)
  request = Net::HTTP::Post.new(uri.path)
  request['Content-Type'] = 'text/xml'
  request['X-HTTP-Method-Override'] = 'get'
  request.body = payload

  response = Net::HTTP.start(uri.host, uri.port) do |http|
    http.request(request)
  end

  puts "Response Code: #{response.code}"
  puts "Response Message: #{response.message}"
  puts "Response Body: #{response.body}"
end

if $0 == __FILE__
  unless ARGV.length >= 2
    $stderr.puts "usage: #{$0} URL PAYLOAD"
    exit -1
  end

  url = ARGV[0]
  payload = ARGV[1]

  puts "Sending request to #{url} with payload:\n#{payload}"
  send_request(url, payload)
end
